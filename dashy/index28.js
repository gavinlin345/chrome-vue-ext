import{cM as ge,az as pe,S as K,i as Q,s as Z,U as we,q as v,V as P,c as S,r as _,u as R,L as h,m as C,t as g,a as w,D as A,d as E,b as N,I as X,cO as ie,K as ne,n as I,a5 as U,R as $e,cP as ye,v as H,x as G,aP as me,ak as ke,O as xe,P as Me,W as De,E as Re,a2 as Ae,eu as Ie,p as re,aI as Y,y as _e,z as be,B as J,C as he,a8 as Se,Z as fe,aa as L,aQ as W,ab as ae,J as Ce,a1 as Ee}from"./overlayscrollbars.js";const z=ge("record_mic",null),q=pe("granted"),oe=pe(null);function je(a){let e,r,t;return e=new X({props:{icon:ie}}),{c(){S(e.$$.fragment),r=ne(" Grant permission")},m(o,i){C(e,o,i),R(o,r,i),t=!0},p:I,i(o){t||(g(e.$$.fragment,o),t=!0)},o(o){w(e.$$.fragment,o),t=!1},d(o){E(e,o),o&&A(r)}}}function Le(a){let e,r,t,o,i;return o=new we({props:{class:"flex-center gap-2 text-base font-medium",$$slots:{default:[je]},$$scope:{ctx:a}}}),o.$on("click",a[0]),{c(){e=v("div"),r=v("span"),r.textContent="To record audio, please allow microphone access.",t=P(),S(o.$$.fragment),_(r,"class","flex-center text-center font-medium leading-6"),_(e,"class","flex h-40 w-[24rem] flex-col items-center justify-center gap-5 py-2 px-6")},m(n,l){R(n,e,l),h(e,r),h(e,t),C(o,e,null),i=!0},p(n,[l]){const s={};l&4&&(s.$$scope={dirty:l,ctx:n}),o.$set(s)},i(n){i||(g(o.$$.fragment,n),i=!0)},o(n){w(o.$$.fragment,n),i=!1},d(n){n&&A(e),E(o)}}}function Te(a,e,r){let t;return N(a,q,i=>r(1,t=i)),[async()=>{if(t==="denied"){window.alert("You've blocked Dashy from accessing microphone, please allow it in your browser settings to use this widget");return}const i=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(n=>{n.name==="NotAllowedError"&&(U(q,t="denied",t),window.alert("You've blocked Dashy from accessing microphone, please allow it in your browser settings to use this widget"))});i&&(U(q,t=(await navigator.permissions.query({name:"microphone"})).state,t),i==null||i.getTracks().forEach(n=>n.stop()))}]}class qe extends K{constructor(e){super(),Q(this,e,Te,Le,Z,{})}}function Pe(a){let e;return{c(){e=v("span"),e.textContent="No audio devices",_(e,"class","text-base")},m(r,t){R(r,e,t)},p:I,i:I,o:I,d(r){r&&A(e)}}}function Ue(a){let e,r,t;function o(n){a[3](n)}let i={options:a[0].map(de),class:"max-w-[11.5rem]"};return a[1]!==void 0&&(i.value=a[1]),e=new ke({props:i}),xe.push(()=>Me(e,"value",o)),{c(){S(e.$$.fragment)},m(n,l){C(e,n,l),t=!0},p(n,l){const s={};l&1&&(s.options=n[0].map(de)),!r&&l&2&&(r=!0,s.value=n[1],De(()=>r=!1)),e.$set(s)},i(n){t||(g(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Ye(a){let e,r,t,o,i,n,l,s,p;const u=[Ue,Pe],m=[];function x(f,y){return f[0].length>0?0:1}return i=x(a),n=m[i]=u[i](a),s=new $e({props:{icon:ye,tooltip:"Refresh"}}),s.$on("click",a[2]),{c(){e=v("div"),r=v("span"),r.textContent="Microphone",t=P(),o=v("div"),n.c(),l=P(),S(s.$$.fragment),_(r,"class","ml-[2px] text-base"),_(o,"class","flex items-center justify-start gap-3"),_(e,"class","flex flex-col items-start justify-start gap-1.5")},m(f,y){R(f,e,y),h(e,r),h(e,t),h(e,o),m[i].m(o,null),h(o,l),C(s,o,null),p=!0},p(f,[y]){let c=i;i=x(f),i===c?m[i].p(f,y):(H(),w(m[c],1,1,()=>{m[c]=null}),G(),n=m[i],n?n.p(f,y):(n=m[i]=u[i](f),n.c()),g(n,1),n.m(o,l))},i(f){p||(g(n),g(s.$$.fragment,f),p=!0)},o(f){w(n),w(s.$$.fragment,f),p=!1},d(f){f&&A(e),m[i].d(),E(s)}}}const de=a=>({label:a.label,value:a.deviceId});function Ne(a,e,r){let t,o;N(a,z,s=>r(1,t=s)),N(a,oe,s=>r(4,o=s));let i=[];const n=async()=>{var u;const s=await navigator.mediaDevices.enumerateDevices();r(0,i=s.filter(m=>m.kind==="audioinput"&&m.deviceId!=="")),i.find(m=>m.deviceId===t)||U(z,t=((u=i.find(m=>m.deviceId==="default"))==null?void 0:u.deviceId)||"",t)};me(async()=>{n()});function l(s){t=s,z.set(t)}return a.$$.update=()=>{var s;a.$$.dirty&3&&U(oe,o=((s=i.find(p=>p.deviceId===t))==null?void 0:s.label)||"",o)},[i,t,n,l]}class We extends K{constructor(e){super(),Q(this,e,Ne,Ye,Z,{})}}function Be(a){let e,r,t,o,i;return r=new We({}),{c(){e=v("div"),S(r.$$.fragment),_(e,"class","flex h-full flex-col items-start justify-center")},m(n,l){R(n,e,l),C(r,e,null),i=!0},p:I,i(n){i||(g(r.$$.fragment,n),n&&_e(()=>{i&&(o&&o.end(1),t=be(e,J,{delay:200,duration:200}),t.start())}),i=!0)},o(n){w(r.$$.fragment,n),t&&t.invalidate(),n&&(o=he(e,J,{duration:200})),i=!1},d(n){n&&A(e),E(r),n&&o&&o.end()}}}function Fe(a){let e,r,t,o,i,n=re.utc(a[0]*1e3).format("mm:ss")+"",l,s,p,u,m,x,f,y,c,b,j,T;return u=new X({props:{icon:ie,class:"mr-2 animate-pulse"}}),{c(){e=v("div"),r=v("canvas"),t=P(),o=v("div"),i=v("span"),l=ne(n),s=P(),p=v("span"),S(u.$$.fragment),m=P(),x=v("span"),f=ne(a[3]),_(r,"id","waveform"),_(r,"class","mb-auto h-16 w-[10rem]"),_(i,"class","text-3xl font-bold"),_(x,"class","max-line-1"),_(p,"class","mt-1 flex items-center justify-start text-sm"),_(o,"class","mb-4 flex flex-col items-start"),_(e,"class","flex h-full flex-col items-start justify-center")},m(k,d){R(k,e,d),h(e,r),h(e,t),h(e,o),h(o,i),h(i,l),h(o,s),h(o,p),C(u,p,null),h(p,m),h(p,x),h(x,f),b=!0,j||(T=Se(a[6].call(null,r)),j=!0)},p(k,d){(!b||d&1)&&n!==(n=re.utc(k[0]*1e3).format("mm:ss")+"")&&fe(l,n),(!b||d&8)&&fe(f,k[3])},i(k){b||(g(u.$$.fragment,k),k&&_e(()=>{b&&(c&&c.end(1),y=be(e,J,{delay:200,duration:200}),y.start())}),b=!0)},o(k){w(u.$$.fragment,k),y&&y.invalidate(),k&&(c=he(e,J,{duration:200})),b=!1},d(k){k&&A(e),E(u),k&&c&&c.end(),j=!1,T()}}}function Oe(a){let e,r,t;return{c(){e=v("button"),e.innerHTML='<div class="animate-breath relative h-16 w-16 rounded-full border-[1px] border-solid border-[red]"><div class="absolute-middle absolute h-12 w-12 rounded-full bg-[red]"></div></div>',_(e,"class","flex-center text-6xl opacity-75 transition hover:scale-105 hover:opacity-100")},m(o,i){R(o,e,i),r||(t=[L(e,"click",a[5]),L(e,"pointerdown",W(a[11])),L(e,"pointerup",W(a[12]))],r=!0)},p:I,i:I,o:I,d(o){o&&A(e),r=!1,ae(t)}}}function Ve(a){let e,r,t,o,i;return r=new X({props:{icon:Ce,class:"animate-spin"}}),{c(){e=v("button"),S(r.$$.fragment),_(e,"class","flex-center text-6xl opacity-75 transition hover:scale-105 hover:opacity-100")},m(n,l){R(n,e,l),C(r,e,null),t=!0,o||(i=[L(e,"click",a[4]),L(e,"pointerdown",W(a[9])),L(e,"pointerup",W(a[10]))],o=!0)},p:I,i(n){t||(g(r.$$.fragment,n),t=!0)},o(n){w(r.$$.fragment,n),t=!1},d(n){n&&A(e),E(r),o=!1,ae(i)}}}function ze(a){let e,r,t,o,i;return r=new X({props:{icon:ie}}),{c(){e=v("button"),S(r.$$.fragment),_(e,"class","flex-center text-6xl opacity-75 transition hover:scale-105 hover:opacity-100")},m(n,l){R(n,e,l),C(r,e,null),t=!0,o||(i=[L(e,"click",a[4]),L(e,"pointerdown",W(a[7])),L(e,"pointerup",W(a[8]))],o=!0)},p:I,i(n){t||(g(r.$$.fragment,n),t=!0)},o(n){w(r.$$.fragment,n),t=!1},d(n){n&&A(e),E(r),o=!1,ae(i)}}}function He(a){let e,r,t,o,i,n,l,s;const p=[Fe,Be],u=[];function m(c,b){return c[1]?0:1}t=m(a),o=u[t]=p[t](a);const x=[ze,Ve,Oe],f=[];function y(c,b){return!c[1]&&!c[2]?0:c[2]?1:2}return n=y(a),l=f[n]=x[n](a),{c(){e=v("div"),r=v("div"),o.c(),i=P(),l.c(),_(r,"class","transition-container h-full"),_(e,"class","flex h-40 w-[24rem] items-center justify-between py-2 pl-6 pr-10")},m(c,b){R(c,e,b),h(e,r),u[t].m(r,null),h(e,i),f[n].m(e,null),s=!0},p(c,[b]){let j=t;t=m(c),t===j?u[t].p(c,b):(H(),w(u[j],1,1,()=>{u[j]=null}),G(),o=u[t],o?o.p(c,b):(o=u[t]=p[t](c),o.c()),g(o,1),o.m(r,null));let T=n;n=y(c),n===T?f[n].p(c,b):(H(),w(f[T],1,1,()=>{f[T]=null}),G(),l=f[n],l?l.p(c,b):(l=f[n]=x[n](c),l.c()),g(l,1),l.m(e,null))},i(c){s||(g(o),g(l),s=!0)},o(c){w(o),w(l),s=!1},d(c){c&&A(e),u[t].d(),f[n].d()}}}function Ge(a,e,r){let t,o;N(a,z,d=>r(16,t=d)),N(a,oe,d=>r(3,o=d));let i,n,l=0,s=!1,p=null,u=!1;Re("appView");const m=async()=>{try{r(2,u=!0);const d=(await Ie(()=>import("./index34.js").then($=>$.i),["index34.js","overlayscrollbars.js","overlayscrollbars.css"])).default;i=new d({bitRate:128,...t?{deviceId:t}:{}}),i.start().then($=>{n=$,r(2,u=!1),r(1,s=!0),p=setInterval(()=>{r(0,l=l+1)},1e3)}).catch($=>{console.warn($)})}catch{r(2,u=!1),console.warn("Failed to load recorder")}},x=()=>{i&&i.stop().getMp3().then(([d,$])=>{r(1,s=!1),r(0,l=0),clearInterval(p),i=null;const M="Audio_"+re().format("YYYYMMDD_HHmmss")+".mp3",B=new File(d,M,{type:$.type,lastModified:Date.now()}),O=URL.createObjectURL(B),D=document.createElement("a");D.href=O,D.setAttribute("download",M),document.body.appendChild(D),D.click(),URL.revokeObjectURL(O),D.remove()}).catch(d=>{console.warn(d)})},f=d=>{const $=d,M=$.getContext("2d"),B=new window.AudioContext;let O=n,D=null,ee=null,se=null;ee=B.createMediaStreamSource(O),D=B.createAnalyser(),ee.connect(D),D.fftSize=2048;const te=D.frequencyBinCount,le=new Uint8Array(te);function ce(){se=requestAnimationFrame(ce),D.getByteTimeDomainData(le),M.clearRect(0,0,$.width,$.height),M.fillStyle="rgba(255, 255, 255, 0)",M.fillRect(0,0,$.width,$.height),M.lineWidth=3,M.strokeStyle="rgb(255, 255, 255)",M.beginPath();const ve=$.width*1/te;let F=0;for(let V=0;V<te;V++){const ue=le[V]/128*$.height/2;V===0?M.moveTo(F,ue):M.lineTo(F,ue),F+=ve,F>=$.width&&(F=0)}M.stroke()}return ce(),{destroy(){cancelAnimationFrame(se),D.disconnect(),ee.disconnect(),B.close()}}};Ae(()=>{i&&i.stop()});function y(d){Y.call(this,a,d)}function c(d){Y.call(this,a,d)}function b(d){Y.call(this,a,d)}function j(d){Y.call(this,a,d)}function T(d){Y.call(this,a,d)}function k(d){Y.call(this,a,d)}return[l,s,u,o,m,x,f,y,c,b,j,T,k]}class Je extends K{constructor(e){super(),Q(this,e,Ge,He,Z,{})}}function Ke(a){let e,r;return e=new qe({}),{c(){S(e.$$.fragment)},m(t,o){C(e,t,o),r=!0},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Qe(a){let e,r;return e=new Je({}),{c(){S(e.$$.fragment)},m(t,o){C(e,t,o),r=!0},i(t){r||(g(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Ze(a){let e,r,t,o;const i=[Qe,Ke],n=[];function l(s,p){return s[0]==="granted"?0:1}return e=l(a),r=n[e]=i[e](a),{c(){r.c(),t=Ee()},m(s,p){n[e].m(s,p),R(s,t,p),o=!0},p(s,[p]){let u=e;e=l(s),e!==u&&(H(),w(n[u],1,1,()=>{n[u]=null}),G(),r=n[e],r||(r=n[e]=i[e](s),r.c()),g(r,1),r.m(t.parentNode,t))},i(s){o||(g(r),o=!0)},o(s){w(r),o=!1},d(s){n[e].d(s),s&&A(t)}}}function Xe(a,e,r){let t;return N(a,q,o=>r(0,t=o)),me(async()=>{try{U(q,t=(await navigator.permissions.query({name:"microphone"})).state,t)}catch{const i=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(n=>{n.name==="NotAllowedError"&&(U(q,t="denied",t),window.alert("You've blocked Dashy from accessing microphone, please allow it in your browser settings to use this widget"))});i&&(U(q,t="granted",t),i==null||i.getTracks().forEach(n=>n.stop()))}}),[t]}class nt extends K{constructor(e){super(),Q(this,e,Xe,Ze,Z,{})}}export{nt as default};
