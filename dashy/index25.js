import{S as Me,i as ye,s as Te,R as Ie,ao as Ve,aG as ls,q as A,V as Y,c as z,r as I,u as G,L,m as j,t as m,v as Z,a as b,x as H,D as N,d as B,E as le,b as O,ak as Ht,a1 as Ce,O as be,P as he,N as Qt,W as $e,K as oe,a7 as we,Z as Be,o as re,bf as Xe,U as je,ae as Kt,n as Q,al as Jt,as as Xt,ah as Pe,Q as Pt,aa as Ee,a8 as xe,a9 as xt,ab as et,ai as es,aj as Oe,cr as ts,an as os,I as Ge,y as ce,z as tt,B as pe,C as st,am as rs,af as We,ag as is,T as as,a5 as V,aQ as fs,e7 as us,du as cs,p as _e,ea as pt,bv as nt,ac as ss,_ as x,aq as ie,bZ as lt,b_ as ot,b$ as rt,c0 as it,cY as ds,aE as ns,aD as ps,ar as gs,eb as _s,aP as ms,at as ks,ec as bs,a3 as gt,br as hs,aw as ze,ax as _t,e as mt,az as Ye,ay as $s,l as ge,ed as ws,aA as Ts,av as Is,aB as vs}from"./overlayscrollbars.js";import{I as kt}from"./IntegrationItem.js";import{C as Ls}from"./Card.js";import{C as Ss}from"./Chip.js";import{S as Ds}from"./SlideDown.js";function bt(l){var s;let e,t;return e=new Ht({props:{options:l[3].map($t),value:(s=l[4])==null?void 0:s.id,placeholder:"Select a task list",$$slots:{default:[Ms,({option:n})=>({23:n}),({option:n})=>n?8388608:0]},$$scope:{ctx:l}}}),e.$on("change",l[13]),e.$on("pointerdown",l[14]),{c(){z(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){var u;const a={};o&8&&(a.options=n[3].map($t)),o&16&&(a.value=(u=n[4])==null?void 0:u.id),o&25165824&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(m(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function ht(l){var i;let e,t,s,n,o,a=((i=l[23])==null?void 0:i.label)+"",u;return{c(){var r;e=A("div"),t=A("img"),n=Y(),o=A("span"),u=oe(a),we(t.src,s=(r=l[23])==null?void 0:r.icon)||I(t,"src",s),I(t,"alt","Provider"),I(t,"class","h-4"),I(o,"class","max-line-1 max-w-[6rem] text-sm"),I(e,"class","flex items-center justify-start gap-2")},m(r,f){G(r,e,f),L(e,t),L(e,n),L(e,o),L(o,u)},p(r,f){var c,d;f&8388608&&!we(t.src,s=(c=r[23])==null?void 0:c.icon)&&I(t,"src",s),f&8388608&&a!==(a=((d=r[23])==null?void 0:d.label)+"")&&Be(u,a)},d(r){r&&N(e)}}}function Ms(l){let e,t=l[23]&&ht(l);return{c(){t&&t.c(),e=Ce()},m(s,n){t&&t.m(s,n),G(s,e,n)},p(s,n){s[23]?t?t.p(s,n):(t=ht(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(s){t&&t.d(s),s&&N(e)}}}function ys(l){let e,t,s,n,o,a=l[23].label+"",u;return{c(){e=A("div"),t=A("img"),n=Y(),o=A("span"),u=oe(a),we(t.src,s=l[23].icon)||I(t,"src",s),I(t,"alt","Provider"),I(t,"class","h-4"),I(o,"class","max-line-1 max-w-[6rem] text-sm"),I(e,"class","flex w-full items-center justify-start gap-2")},m(i,r){G(i,e,r),L(e,t),L(e,n),L(e,o),L(o,u)},p(i,r){r&8388608&&!we(t.src,s=i[23].icon)&&I(t,"src",s),r&8388608&&a!==(a=i[23].label+"")&&Be(u,a)},d(i){i&&N(e)}}}function Cs(l){let e,t;function s(){return l[17](l[22])}return e=new je({props:{size:"sm",disabled:l[0].length===0,$$slots:{default:[Es]},$$scope:{ctx:l}}}),e.$on("click",s),{c(){z(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){l=n;const a={};o&1&&(a.disabled=l[0].length===0),o&16777216&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(n){t||(m(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function As(l){let e,t;return e=new Kt({}),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},p:Q,i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Es(l){let e;return{c(){e=oe("Add")},m(t,s){G(t,e,s)},d(t){t&&N(e)}}}function Gs(l){let e,t,s,n,o,a,u,i,r,f;function c(g){l[15](g)}let d={options:[{label:"Dashy",value:"dashy",icon:"/icon.png"},...l[5]?[{label:"Google Tasks",value:"google",icon:"/apps/google_tasks.png"}]:[],...l[6]?[{label:"Microsoft To-Do",value:"microsoft",icon:"/apps/microsoft_todo.png"}]:[]],placeholder:"Select a task list",class:"w-full",$$slots:{default:[ys,({option:g})=>({23:g}),({option:g})=>g?8388608:0]},$$scope:{ctx:l}};l[1]!==void 0&&(d.value=l[1]),e=new Ht({props:d}),be.push(()=>he(e,"value",c));function h(g){l[16](g)}let T={class:"w-full px-2",placeholder:"List name",size:"sm"};l[0]!==void 0&&(T.value=l[0]),n=new Qt({props:T}),be.push(()=>he(n,"value",h));const k=[As,Cs],p=[];function y(g,_){return g[2]?0:1}return u=y(l),i=p[u]=k[u](l),{c(){z(e.$$.fragment),s=Y(),z(n.$$.fragment),a=Y(),i.c(),r=Ce()},m(g,_){j(e,g,_),G(g,s,_),j(n,g,_),G(g,a,_),p[u].m(g,_),G(g,r,_),f=!0},p(g,_){const $={};_&96&&($.options=[{label:"Dashy",value:"dashy",icon:"/icon.png"},...g[5]?[{label:"Google Tasks",value:"google",icon:"/apps/google_tasks.png"}]:[],...g[6]?[{label:"Microsoft To-Do",value:"microsoft",icon:"/apps/microsoft_todo.png"}]:[]]),_&25165824&&($.$$scope={dirty:_,ctx:g}),!t&&_&2&&(t=!0,$.value=g[1],$e(()=>t=!1)),e.$set($);const S={};!o&&_&1&&(o=!0,S.value=g[0],$e(()=>o=!1)),n.$set(S);let U=u;u=y(g),u===U?p[u].p(g,_):(Z(),b(p[U],1,1,()=>{p[U]=null}),H(),i=p[u],i?i.p(g,_):(i=p[u]=k[u](g),i.c()),m(i,1),i.m(r.parentNode,r))},i(g){f||(m(e.$$.fragment,g),m(n.$$.fragment,g),m(i),f=!0)},o(g){b(e.$$.fragment,g),b(n.$$.fragment,g),b(i),f=!1},d(g){B(e,g),g&&N(s),B(n,g),g&&N(a),p[u].d(g),g&&N(r)}}}function Ns(l){let e,t,s,n,o,a,u,i=l[3].length!==0&&bt(l);return n=new Ie({props:{icon:Ve,tooltip:"Add list",stopPropogation:!1}}),a=new ls({props:{trigger:"click",class:"flex flex-col items-center justify-center gap-2 px-2 py-2",placement:"top-start",$$slots:{default:[Gs,({close:r})=>({22:r}),({close:r})=>r?4194304:0]},$$scope:{ctx:l}}}),{c(){e=A("div"),i&&i.c(),t=Y(),s=A("div"),z(n.$$.fragment),o=Y(),z(a.$$.fragment),I(e,"class","flex items-center justify-start gap-3")},m(r,f){G(r,e,f),i&&i.m(e,null),L(e,t),L(e,s),j(n,s,null),L(e,o),j(a,e,null),u=!0},p(r,[f]){r[3].length!==0?i?(i.p(r,f),f&8&&m(i,1)):(i=bt(r),i.c(),m(i,1),i.m(e,t)):i&&(Z(),b(i,1,1,()=>{i=null}),H());const c={};f&20971623&&(c.$$scope={dirty:f,ctx:r}),a.$set(c)},i(r){u||(m(i),m(n.$$.fragment,r),m(a.$$.fragment,r),u=!0)},o(r){b(i),b(n.$$.fragment,r),b(a.$$.fragment,r),u=!1},d(r){r&&N(e),i&&i.d(),B(n),B(a)}}}const $t=l=>({label:l.title,value:l.id,id:l.id,icon:l.source==="google"?"/apps/google_tasks.png":l.source==="microsoft"?"/apps/microsoft_todo.png":"/icon.png"});function Us(l,e,t){let s,n,o,a;const{availableTasksList:u,dashyTasks:i,dashyTasksList:r,googleTasksList:f,isGoogleTasksIntegrated:c,isMicrosoftTodoIntegrated:d,selectedTaskList:h,todoTasksList:T}=le("stores");O(l,u,v=>t(3,s=v)),O(l,c,v=>t(5,o=v)),O(l,d,v=>t(6,a=v)),O(l,h,v=>t(4,n=v));let k="",p="dashy",y=!1;const g=le("appView"),_=async v=>{if(t(2,y=!0),k!==""){if(p==="google"||p==="microsoft"){const D=p==="google"?"/integration/google_tasks/create_list":"/integration/microsoft_todo/create_list",F=await re.post(D,{title:k}),K=F.data&&F.data.list;K&&p==="google"&&f.update(X=>[...X,K]),K&&p==="microsoft"&&T.update(X=>[...X,K]),K&&(t(2,y=!1),h.set({...K,source:p}),t(0,k=""),v==null||v())}else if(p==="dashy"){const D=Xe();r.update(F=>(F.push({id:D,title:k,source:"dashy"}),F)),i.update(F=>(F[D]={completed:[],tasks:[]},F)),t(2,y=!1),h.set({id:D,title:k,source:"dashy"}),t(0,k=""),v==null||v()}}},$=v=>{h.set(s.find(D=>D.id===v.detail))},S=()=>{g.set(!0)};function U(v){p=v,t(1,p)}function E(v){k=v,t(0,k)}return[k,p,y,s,n,o,a,u,c,d,h,g,_,$,S,U,E,v=>_(v)]}class zs extends Me{constructor(e){super(),ye(this,e,Us,Ns,Te,{})}}function wt(l){var n,o,a,u,i;let e,t,s=(((i=(u=(a=l[2][(n=l[1])==null?void 0:n.source])==null?void 0:a[(o=l[1])==null?void 0:o.id])==null?void 0:u.completed)==null?void 0:i.length)>0||l[3])&&Tt(l);return{c(){s&&s.c(),e=Ce()},m(r,f){s&&s.m(r,f),G(r,e,f),t=!0},p(r,f){var c,d,h,T,k;((k=(T=(h=r[2][(c=r[1])==null?void 0:c.source])==null?void 0:h[(d=r[1])==null?void 0:d.id])==null?void 0:T.completed)==null?void 0:k.length)>0||r[3]?s?(s.p(r,f),f&14&&m(s,1)):(s=Tt(r),s.c(),m(s,1),s.m(e.parentNode,e)):s&&(Z(),b(s,1,1,()=>{s=null}),H())},i(r){t||(m(s),t=!0)},o(r){b(s),t=!1},d(r){s&&s.d(r),r&&N(e)}}}function Tt(l){let e,t,s,n,o;function a(i){l[17](i)}let u={};return l[3]!==void 0&&(u.checked=l[3]),s=new Pt({props:u}),be.push(()=>he(s,"checked",a)),{c(){e=A("span"),t=oe("Show completed tasks "),z(s.$$.fragment),I(e,"class","flex-center ml-0.5 w-max gap-2 text-sm")},m(i,r){G(i,e,r),L(e,t),j(s,e,null),o=!0},p(i,r){const f={};!n&&r&8&&(n=!0,f.checked=i[3],$e(()=>n=!1)),s.$set(f)},i(i){o||(m(s.$$.fragment,i),o=!0)},o(i){b(s.$$.fragment,i),o=!1},d(i){i&&N(e),B(s)}}}function It(l){let e,t,s;return{c(){e=A("button"),e.innerHTML='<img src="/apps/google_tasks.png" alt="Meeting" class="h-[1.2rem]"/>',I(e,"class","flex items-center opacity-70 transition hover:opacity-100")},m(n,o){G(n,e,o),t||(s=[Ee(e,"click",l[18]),xe(xt.call(null,e,"Connect with Google Tasks"))],t=!0)},p:Q,d(n){n&&N(e),t=!1,et(s)}}}function vt(l){let e,t,s;return{c(){e=A("button"),e.innerHTML='<img src="/apps/microsoft_todo.png" alt="Meeting" class="h-[1.2rem]"/>',I(e,"class","flex items-center opacity-70 transition hover:opacity-100")},m(n,o){G(n,e,o),t||(s=[Ee(e,"click",l[19]),xe(xt.call(null,e,"Connect with Microsoft To Do"))],t=!0)},p:Q,d(n){n&&N(e),t=!1,et(s)}}}function js(l){let e,t;return e=new Kt({props:{class:"text-xl"}}),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},p:Q,i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Bs(l){let e,t;return e=new Ie({props:{icon:os,class:"text-xl",tooltip:"Refresh tasks"}}),e.$on("click",l[8]),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},p:Q,i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Fs(l){let e,t,s,n,o,a,u,i,r,f,c,d,h,T=l[1]&&wt(l);n=new zs({});let k=!l[4]&&It(l),p=!l[6]&&vt(l);const y=[Bs,js],g=[];function _($,S){return $[7]?1:0}return r=_(l),f=g[r]=y[r](l),d=new Ie({props:{icon:Jt,class:"text-xl",tooltip:"Settings"}}),d.$on("click",function(){Xt(l[0])&&l[0].apply(this,arguments)}),{c(){e=A("div"),T&&T.c(),t=Y(),s=A("div"),z(n.$$.fragment),o=Y(),a=A("div"),k&&k.c(),u=Y(),p&&p.c(),i=Y(),f.c(),c=Y(),z(d.$$.fragment),I(a,"class","mr-1 flex items-center gap-4"),I(s,"class","mt-2.5 flex w-full justify-between gap-3"),I(e,"class","mt-2.5 box-border flex w-full flex-col justify-between px-2.5")},m($,S){G($,e,S),T&&T.m(e,null),L(e,t),L(e,s),j(n,s,null),L(s,o),L(s,a),k&&k.m(a,null),L(a,u),p&&p.m(a,null),L(a,i),g[r].m(a,null),L(a,c),j(d,a,null),h=!0},p($,[S]){l=$,l[1]?T?(T.p(l,S),S&2&&m(T,1)):(T=wt(l),T.c(),m(T,1),T.m(e,t)):T&&(Z(),b(T,1,1,()=>{T=null}),H()),l[4]?k&&(k.d(1),k=null):k?k.p(l,S):(k=It(l),k.c(),k.m(a,u)),l[6]?p&&(p.d(1),p=null):p?p.p(l,S):(p=vt(l),p.c(),p.m(a,i));let U=r;r=_(l),r===U?g[r].p(l,S):(Z(),b(g[U],1,1,()=>{g[U]=null}),H(),f=g[r],f?f.p(l,S):(f=g[r]=y[r](l),f.c()),m(f,1),f.m(a,c))},i($){h||(m(T),m(n.$$.fragment,$),m(f),m(d.$$.fragment,$),h=!0)},o($){b(T),b(n.$$.fragment,$),b(f),b(d.$$.fragment,$),h=!1},d($){$&&N(e),T&&T.d(),B(n),k&&k.d(),p&&p.d(),g[r].d(),B(d)}}}function Rs(l,e,t){let s,n,o,a,u,i,r;O(l,Pe,E=>t(5,u=E));const{updateTasks:f}=le("utils"),{allTasks:c,isGoogleTasksIntegrated:d,isMicrosoftTodoIntegrated:h,selectedTaskList:T,showCompletedTasks:k,updatingTasks:p,microsoftIntegrationId:y,googleIntegrationId:g}=le("stores");O(l,c,E=>t(2,n=E)),O(l,d,E=>t(4,a=E)),O(l,h,E=>t(6,i=E)),O(l,T,E=>t(1,s=E)),O(l,k,E=>t(3,o=E)),O(l,p,E=>t(7,r=E));let{toggleSettings:_}=e;console.log("micro",y);function $(E){o=E,k.set(o)}const S=()=>es({user:Oe.currentUser,currentProfile:u,integration:"google_tasks",integration_id:g}),U=()=>ts({user:Oe.currentUser,currentProfile:u,integration:"microsoft_todo",integration_id:y});return l.$$set=E=>{"toggleSettings"in E&&t(0,_=E.toggleSettings)},[_,s,n,o,a,u,i,r,f,c,d,h,T,k,p,y,g,$,S,U]}class Ys extends Me{constructor(e){super(),ye(this,e,Rs,Fs,Te,{toggleSettings:0})}}function Lt(l,e,t){const s=l.slice();return s[14]=e[t],s}function St(l){let e,t,s,n,o=[],a=new Map,u,i=l[2];const r=f=>f[14].id;for(let f=0;f<i.length;f+=1){let c=Lt(l,i,f),d=r(c);a.set(d,o[f]=Dt(d,c))}return{c(){e=A("div"),t=A("span"),t.textContent="Manage tasks lists",s=Y(),n=A("div");for(let f=0;f<o.length;f+=1)o[f].c();I(t,"class","mb-1 font-medium"),I(n,"class","scrollbar flex max-h-48 flex-col gap-2 overflow-auto"),I(e,"class","mt-2 flex flex-col gap-2")},m(f,c){G(f,e,c),L(e,t),L(e,s),L(e,n);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(n,null);u=!0},p(f,c){c&60&&(i=f[2],Z(),o=We(o,c,r,1,f,i,a,n,is,Dt,null,Lt),H())},i(f){if(!u){for(let c=0;c<i.length;c+=1)m(o[c]);u=!0}},o(f){for(let c=0;c<o.length;c+=1)b(o[c]);u=!1},d(f){f&&N(e);for(let c=0;c<o.length;c+=1)o[c].d()}}}function Dt(l,e){var T,k;let t,s,n,o,a,u,i,r=e[14].title+"",f,c,d;function h(){return e[11](e[14])}return s=new Pt({props:{round:!0,filled:!0,size:"1.15",checked:!e[3].includes(e[14].id),disabled:e[14].id==="default"||e[14].id===((T=e[4])==null?void 0:T.id),label:e[14].id==="default"?"This list cannot be excluded":e[14].id===((k=e[4])==null?void 0:k.id)?"This list is currently selected":!1}}),s.$on("change",h),{key:l,first:null,c(){t=A("div"),z(s.$$.fragment),n=Y(),o=A("img"),u=Y(),i=A("span"),f=oe(r),c=Y(),we(o.src,a=e[5](e[14].source))||I(o,"src",a),I(o,"class","w-5"),I(o,"alt","Provider logo"),I(i,"class","max-line-1 w-max text-base"),I(t,"class","flex items-center gap-3"),this.first=t},m(p,y){G(p,t,y),j(s,t,null),L(t,n),L(t,o),L(t,u),L(t,i),L(i,f),L(t,c),d=!0},p(p,y){var _,$;e=p;const g={};y&12&&(g.checked=!e[3].includes(e[14].id)),y&20&&(g.disabled=e[14].id==="default"||e[14].id===((_=e[4])==null?void 0:_.id)),y&20&&(g.label=e[14].id==="default"?"This list cannot be excluded":e[14].id===(($=e[4])==null?void 0:$.id)?"This list is currently selected":!1),s.$set(g),(!d||y&4&&!we(o.src,a=e[5](e[14].source)))&&I(o,"src",a),(!d||y&4)&&r!==(r=e[14].title+"")&&Be(f,r)},i(p){d||(m(s.$$.fragment,p),d=!0)},o(p){b(s.$$.fragment,p),d=!1},d(p){p&&N(t),B(s)}}}function Os(l){let e,t,s;return e=new Ge({props:{icon:as,class:"mr-2"}}),{c(){z(e.$$.fragment),t=oe(`
    View tasks`)},m(n,o){j(e,n,o),G(n,t,o),s=!0},p:Q,i(n){s||(m(e.$$.fragment,n),s=!0)},o(n){b(e.$$.fragment,n),s=!1},d(n){B(e,n),n&&N(t)}}}function Vs(l){let e,t,s,n,o,a,u,i,r,f,c,d,h,T,k;s=new Ge({props:{icon:Jt,class:"mr-3"}}),u=new kt({props:{integration:{...l[1].find(Mt),id:l[10]}}}),r=new kt({props:{integration:{...l[1].find(yt),id:l[9]}}});let p=l[2]&&St(l);return d=new je({props:{class:"flex-center mb-1 mt-2 self-center",$$slots:{default:[Os]},$$scope:{ctx:l}}}),d.$on("click",function(){Xt(l[0])&&l[0].apply(this,arguments)}),{c(){e=A("div"),t=A("span"),z(s.$$.fragment),n=oe(`
    Settings`),o=Y(),a=A("div"),z(u.$$.fragment),i=Y(),z(r.$$.fragment),f=Y(),p&&p.c(),c=Y(),z(d.$$.fragment),I(t,"class","flex-center self-start text-lg font-bold"),I(a,"class","mt-2 flex flex-col items-center justify-start gap-5"),I(e,"class","flex h-full flex-col gap-4 overflow-auto px-3 py-2")},m(y,g){G(y,e,g),L(e,t),j(s,t,null),L(t,n),L(e,o),L(e,a),j(u,a,null),L(a,i),j(r,a,null),L(e,f),p&&p.m(e,null),L(e,c),j(d,e,null),k=!0},p(y,[g]){l=y;const _={};g&2&&(_.integration={...l[1].find(Mt),id:l[10]}),u.$set(_);const $={};g&2&&($.integration={...l[1].find(yt),id:l[9]}),r.$set($),l[2]?p?(p.p(l,g),g&4&&m(p,1)):(p=St(l),p.c(),m(p,1),p.m(e,c)):p&&(Z(),b(p,1,1,()=>{p=null}),H());const S={};g&131072&&(S.$$scope={dirty:g,ctx:l}),d.$set(S)},i(y){k||(m(s.$$.fragment,y),m(u.$$.fragment,y),m(r.$$.fragment,y),m(p),m(d.$$.fragment,y),y&&ce(()=>{k&&(T&&T.end(1),h=tt(e,pe,{delay:200,duration:200}),h.start())}),k=!0)},o(y){b(s.$$.fragment,y),b(u.$$.fragment,y),b(r.$$.fragment,y),b(p),b(d.$$.fragment,y),h&&h.invalidate(),y&&(T=st(e,pe,{duration:200})),k=!1},d(y){y&&N(e),B(s),B(u),B(r),p&&p.d(),B(d),y&&T&&T.end()}}}const Mt=l=>l.id==="google_tasks",yt=l=>l.id==="microsoft_todo";function Ws(l,e,t){let s,n,o,a;O(l,rs,k=>t(1,s=k));const{getIconForProvider:u}=le("utils"),{allTasksList:i,excludedTaskLists:r,selectedTaskList:f,microsoftIntegrationId:c,googleIntegrationId:d}=le("stores");O(l,i,k=>t(2,n=k)),O(l,r,k=>t(3,o=k)),O(l,f,k=>t(4,a=k));let{toggleSettings:h}=e;const T=k=>{o.includes(k.id)?V(r,o=o.filter(p=>p!==k.id),o):V(r,o=[...o,k.id],o)};return l.$$set=k=>{"toggleSettings"in k&&t(0,h=k.toggleSettings)},[h,s,n,o,a,u,i,r,f,c,d,T]}class qs extends Me{constructor(e){super(),ye(this,e,Ws,Vs,Te,{toggleSettings:0})}}function Ct(l,e,t){const s=l.slice();return s[47]=e[t],s[49]=t,s}function At(l,e,t){const s=l.slice();return s[47]=e[t],s[49]=t,s}function Zs(l){let e,t,s,n;return t=new Ge({props:{icon:ds}}),{c(){e=A("div"),z(t.$$.fragment),I(e,"class","flex-center")},m(o,a){G(o,e,a),j(t,e,null),n=!0},p:Q,i(o){n||(m(t.$$.fragment,o),o&&ce(()=>{n&&(s||(s=x(e,pe,{},!0)),s.run(1))}),n=!0)},o(o){b(t.$$.fragment,o),o&&(s||(s=x(e,pe,{},!1)),s.run(0)),n=!1},d(o){o&&N(e),B(t),o&&s&&s.end()}}}function Hs(l){let e,t,s,n;return t=new Ge({props:{icon:ns}}),{c(){e=A("div"),z(t.$$.fragment),I(e,"class","flex-center")},m(o,a){G(o,e,a),j(t,e,null),n=!0},p:Q,i(o){n||(m(t.$$.fragment,o),o&&ce(()=>{n&&(s||(s=x(e,pe,{},!0)),s.run(1))}),n=!0)},o(o){b(t.$$.fragment,o),o&&(s||(s=x(e,pe,{},!1)),s.run(0)),n=!1},d(o){o&&N(e),B(t),o&&s&&s.end()}}}function Qs(l){let e,t,s,n;return t=new Ge({props:{icon:ns}}),{c(){e=A("div"),z(t.$$.fragment),I(e,"class","flex-center")},m(o,a){G(o,e,a),j(t,e,null),n=!0},p:Q,i(o){n||(m(t.$$.fragment,o),o&&ce(()=>{n&&(s||(s=x(e,pe,{},!0)),s.run(1))}),n=!0)},o(o){b(t.$$.fragment,o),o&&(s||(s=x(e,pe,{},!1)),s.run(0)),n=!1},d(o){o&&N(e),B(t),o&&s&&s.end()}}}function Ks(l){let e,t,s;return{c(){e=A("span"),t=oe(l[5]),I(e,"class",s="max-line-2 w-full text-start "+(l[2]?"text-[0.85rem] leading-[1.2rem]":"text-[0.9rem] leading-6"))},m(n,o){G(n,e,o),L(e,t)},p(n,o){o[0]&32&&Be(t,n[5]),o[0]&4&&s!==(s="max-line-2 w-full text-start "+(n[2]?"text-[0.85rem] leading-[1.2rem]":"text-[0.9rem] leading-6"))&&I(e,"class",s)},d(n){n&&N(e)}}}function Js(l){let e,t,s,n;function o(i){l[26](i)}function a(i){l[27](i)}let u={placeholder:"Task title",class:"no-border w-full shrink-0 px-0 py-0 "+(l[2]?"text-[0.85rem] leading-[1.2rem]":"text-[0.9rem] leading-6"),wrapperClass:"w-full",styles:"background: transparent;",autoFocus:!0};return l[7]!==void 0&&(u.element=l[7]),l[5]!==void 0&&(u.value=l[5]),e=new nt({props:u}),be.push(()=>he(e,"element",o)),be.push(()=>he(e,"value",a)),e.$on("keydown",l[28]),{c(){z(e.$$.fragment)},m(i,r){j(e,i,r),n=!0},p(i,r){const f={};r[0]&4&&(f.class="no-border w-full shrink-0 px-0 py-0 "+(i[2]?"text-[0.85rem] leading-[1.2rem]":"text-[0.9rem] leading-6")),!t&&r[0]&128&&(t=!0,f.element=i[7],$e(()=>t=!1)),!s&&r[0]&32&&(s=!0,f.value=i[5],$e(()=>s=!1)),e.$set(f)},i(i){n||(m(e.$$.fragment,i),n=!0)},o(i){b(e.$$.fragment,i),n=!1},d(i){B(e,i)}}}function Et(l){let e,t;return e=new Ss({props:{class:"ml-auto shrink-0 px-[0.65rem] py-[0.07rem] text-[0.7rem]",styles:"background: "+(_e(l[9]).isBefore(_e(),"day")?"#ff5959":"transparent")+"; color:white",$$slots:{default:[Xs]},$$scope:{ctx:l}}}),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},p(s,n){const o={};n[0]&512&&(o.styles="background: "+(_e(s[9]).isBefore(_e(),"day")?"#ff5959":"transparent")+"; color:white"),n[0]&512|n[1]&1048576&&(o.$$scope={dirty:n,ctx:s}),e.$set(o)},i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Xs(l){let e=_e(l[9]).format("DD MMM")+"",t;return{c(){t=oe(e)},m(s,n){G(s,t,n)},p(s,n){n[0]&512&&e!==(e=_e(s[9]).format("DD MMM")+"")&&Be(t,e)},d(s){s&&N(t)}}}function Gt(l){let e,t;return e=new Ie({props:{class:"ml-auto",icon:ss,size:"sm",tooltip:"Delete subtask"}}),e.$on("click",l[17]),e.$on("click",en),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},p:Q,i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Nt(l){let e,t,s,n,o,a,u,i,r,f,c,d,h,T,k,p,y,g,_;function $(v){l[29](v)}let S={placeholder:"Add notes",class:"w-full shrink-0 px-2.5 py-[0.5rem] text-[0.8rem]",size:"sm"};l[6]!==void 0&&(S.value=l[6]),t=new nt({props:S}),be.push(()=>he(t,"value",$));let U=!l[13]&&!l[2]&&Ut(l);h=new Ie({props:{icon:ss,size:"md",tooltip:"Delete task"}}),h.$on("click",l[17]),h.$on("click",tn);let E=!l[2]&&zt(),R=l[13]&&jt(l);return{c(){e=A("div"),z(t.$$.fragment),n=Y(),o=A("div"),a=A("span"),u=oe("Due Date "),i=A("input"),f=Y(),c=A("div"),U&&U.c(),d=Y(),z(h.$$.fragment),T=Y(),E&&E.c(),k=Y(),R&&R.c(),I(i,"type","date"),I(i,"placeholder","Due Date"),i.value=r=l[9]?_e(l[9]).format("YYYY-MM-DD"):"",I(i,"class","svelte-1cyd8ai"),I(a,"class","flex-center ml-0.5 gap-3 text-[0.8rem]"),I(c,"class","flex items-center gap-3"),I(o,"class","mt-3 flex w-full items-center justify-between"),I(e,"class","task-options mt-3 mb-1 flex flex-col items-start")},m(v,D){G(v,e,D),j(t,e,null),L(e,n),L(e,o),L(o,a),L(a,u),L(a,i),L(o,f),L(o,c),U&&U.m(c,null),L(c,d),j(h,c,null),L(e,T),E&&E.m(e,null),L(e,k),R&&R.m(e,null),y=!0,g||(_=Ee(i,"change",l[19]),g=!0)},p(v,D){const F={};!s&&D[0]&64&&(s=!0,F.value=v[6],$e(()=>s=!1)),t.$set(F),(!y||D[0]&512&&r!==(r=v[9]?_e(v[9]).format("YYYY-MM-DD"):""))&&(i.value=r),!v[13]&&!v[2]?U?(U.p(v,D),D[0]&8196&&m(U,1)):(U=Ut(v),U.c(),m(U,1),U.m(c,d)):U&&(Z(),b(U,1,1,()=>{U=null}),H()),v[2]?E&&(E.d(1),E=null):E||(E=zt(),E.c(),E.m(e,k)),v[13]?R?(R.p(v,D),D[0]&8192&&m(R,1)):(R=jt(v),R.c(),m(R,1),R.m(e,null)):R&&(Z(),b(R,1,1,()=>{R=null}),H())},i(v){y||(m(t.$$.fragment,v),m(U),m(h.$$.fragment,v),m(R),v&&ce(()=>{y&&(p||(p=x(e,ie,{},!0)),p.run(1))}),y=!0)},o(v){b(t.$$.fragment,v),b(U),b(h.$$.fragment,v),b(R),v&&(p||(p=x(e,ie,{},!1)),p.run(0)),y=!1},d(v){v&&N(e),B(t),U&&U.d(),B(h),E&&E.d(),R&&R.d(),v&&p&&p.end(),g=!1,_()}}}function Ut(l){let e,t;return e=new Ie({props:{icon:Ve,size:"lg",tooltip:"Add subtasks"}}),e.$on("click",l[30]),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},p:Q,i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function zt(l){return{c:Q,m:Q,d:Q}}function jt(l){let e,t,s,n,o,a,u;function i(f){l[31](f)}let r={placeholder:"Add a new subtask",class:"shrink-0 grow px-2.5 py-[0.5rem] text-[0.8rem]",size:"sm"};return l[8]!==void 0&&(r.value=l[8]),t=new nt({props:r}),be.push(()=>he(t,"value",i)),t.$on("keypress",l[32]),t.$on("keyup",sn),o=new Ie({props:{icon:Ve,class:"shrink-0",size:"lg"}}),o.$on("click",l[16]),{c(){e=A("div"),z(t.$$.fragment),n=Y(),z(o.$$.fragment),I(e,"class","mb-1 mt-3 flex w-full gap-2")},m(f,c){G(f,e,c),j(t,e,null),L(e,n),j(o,e,null),u=!0},p(f,c){const d={};!s&&c[0]&256&&(s=!0,d.value=f[8],$e(()=>s=!1)),t.$set(d)},i(f){u||(m(t.$$.fragment,f),m(o.$$.fragment,f),f&&ce(()=>{u&&(a||(a=x(e,ie,{},!0)),a.run(1))}),u=!0)},o(f){b(t.$$.fragment,f),b(o.$$.fragment,f),f&&(a||(a=x(e,ie,{},!1)),a.run(0)),u=!1},d(f){f&&N(e),B(t),B(o),f&&a&&a.end()}}}function Bt(l){var r,f;let e,t,s=[],n=new Map,o,a=((f=(r=l[0])==null?void 0:r.subtasks)==null?void 0:f.completed.length)>0&&l[11]&&Ft(l),u=l[0].subtasks.uncompleted;const i=c=>c[47].id;for(let c=0;c<u.length;c+=1){let d=Ct(l,u,c),h=i(d);n.set(h,s[c]=Yt(h,d))}return{c(){e=A("div"),a&&a.c(),t=Y();for(let c=0;c<s.length;c+=1)s[c].c();I(e,"class","subtasks mt-2 mb-1 flex w-full flex-col gap-1.5")},m(c,d){G(c,e,d),a&&a.m(e,null),L(e,t);for(let h=0;h<s.length;h+=1)s[h]&&s[h].m(e,null);o=!0},p(c,d){var h,T;if(((T=(h=c[0])==null?void 0:h.subtasks)==null?void 0:T.completed.length)>0&&c[11]?a?(a.p(c,d),d[0]&2049&&m(a,1)):(a=Ft(c),a.c(),m(a,1),a.m(e,t)):a&&(Z(),b(a,1,1,()=>{a=null}),H()),d[0]&27){u=c[0].subtasks.uncompleted,Z();for(let k=0;k<s.length;k+=1)s[k].r();s=We(s,d,i,1,c,u,n,e,lt,Yt,null,Ct);for(let k=0;k<s.length;k+=1)s[k].a();H()}},i(c){if(!o){m(a);for(let d=0;d<u.length;d+=1)m(s[d]);o=!0}},o(c){b(a);for(let d=0;d<s.length;d+=1)b(s[d]);o=!1},d(c){c&&N(e),a&&a.d();for(let d=0;d<s.length;d+=1)s[d].d()}}}function Ft(l){let e=[],t=new Map,s,n,o=l[0].subtasks.completed;const a=u=>u[47].id;for(let u=0;u<o.length;u+=1){let i=At(l,o,u),r=a(i);t.set(r,e[u]=Rt(r,i))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();s=Ce()},m(u,i){for(let r=0;r<e.length;r+=1)e[r]&&e[r].m(u,i);G(u,s,i),n=!0},p(u,i){if(i[0]&27){o=u[0].subtasks.completed,Z();for(let r=0;r<e.length;r+=1)e[r].r();e=We(e,i,a,1,u,o,t,s.parentNode,lt,Rt,s,At);for(let r=0;r<e.length;r+=1)e[r].a();H()}},i(u){if(!n){for(let i=0;i<o.length;i+=1)m(e[i]);n=!0}},o(u){for(let i=0;i<e.length;i+=1)b(e[i]);n=!1},d(u){for(let i=0;i<e.length;i+=1)e[i].d(u);u&&N(s)}}}function Rt(l,e){let t,s,n,o,a=Q,u;return s=new at({props:{task:e[47],isSubtask:!0,parentTaskId:e[0].id,parentTaskIndex:e[1],parentTaskStatus:e[0].status,index:e[49],listId:e[4],source:e[3]}}),{key:l,first:null,c(){t=A("div"),z(s.$$.fragment),n=Y(),I(t,"class","w-full"),this.first=t},m(i,r){G(i,t,r),j(s,t,null),L(t,n),u=!0},p(i,r){e=i;const f={};r[0]&1&&(f.task=e[47]),r[0]&1&&(f.parentTaskId=e[0].id),r[0]&2&&(f.parentTaskIndex=e[1]),r[0]&1&&(f.parentTaskStatus=e[0].status),r[0]&1&&(f.index=e[49]),r[0]&16&&(f.listId=e[4]),r[0]&8&&(f.source=e[3]),s.$set(f)},r(){o=t.getBoundingClientRect()},f(){ot(t),a()},a(){a(),a=rt(t,o,it,{duration:300})},i(i){u||(m(s.$$.fragment,i),u=!0)},o(i){b(s.$$.fragment,i),u=!1},d(i){i&&N(t),B(s)}}}function Yt(l,e){let t,s,n,o,a=Q,u;return s=new at({props:{task:e[47],isSubtask:!0,parentTaskId:e[0].id,parentTaskIndex:e[1],parentTaskStatus:e[0].status,index:e[49],listId:e[4],source:e[3]}}),{key:l,first:null,c(){t=A("div"),z(s.$$.fragment),n=Y(),I(t,"class","w-full"),this.first=t},m(i,r){G(i,t,r),j(s,t,null),L(t,n),u=!0},p(i,r){e=i;const f={};r[0]&1&&(f.task=e[47]),r[0]&1&&(f.parentTaskId=e[0].id),r[0]&2&&(f.parentTaskIndex=e[1]),r[0]&1&&(f.parentTaskStatus=e[0].status),r[0]&1&&(f.index=e[49]),r[0]&16&&(f.listId=e[4]),r[0]&8&&(f.source=e[3]),s.$set(f)},r(){o=t.getBoundingClientRect()},f(){ot(t),a()},a(){a(),a=rt(t,o,it,{duration:300})},i(i){u||(m(s.$$.fragment,i),u=!0)},o(i){b(s.$$.fragment,i),u=!1},d(i){i&&N(t),B(s)}}}function Ps(l){var U,E,R,v;let e,t,s,n,o,a,u,i,r,f,c,d,h,T;const k=[Qs,Hs,Zs],p=[];function y(D,F){return D[12]?0:D[10]==="completed"?1:2}n=y(l),o=p[n]=k[n](l),u=new Ds({props:{show:l[11],class:"w-full",$$slots:{more:[Js],less:[Ks]},$$scope:{ctx:l}}});let g=l[9]&&!l[11]&&Et(l),_=l[3]==="microsoft"&&l[2]&&l[11]&&Gt(l),$=l[11]&&!(l[3]==="microsoft"&&l[2])&&Nt(l),S=(((E=(U=l[0])==null?void 0:U.subtasks)==null?void 0:E.uncompleted.length)>0||((v=(R=l[0])==null?void 0:R.subtasks)==null?void 0:v.completed.length)>0&&l[11])&&Bt(l);return{c(){e=A("div"),t=A("div"),s=A("button"),o.c(),a=Y(),z(u.$$.fragment),i=Y(),g&&g.c(),r=Y(),_&&_.c(),f=Y(),$&&$.c(),c=Y(),S&&S.c(),I(s,"class","transition-container flex shrink-0 items-center text-sm opacity-60 transition hover:opacity-100"),I(t,"class","main-info flex w-full items-center gap-3"),I(e,"class","task group flex flex-col")},m(D,F){G(D,e,F),L(e,t),L(t,s),p[n].m(s,null),L(t,a),j(u,t,null),L(t,i),g&&g.m(t,null),L(t,r),_&&_.m(t,null),L(e,f),$&&$.m(e,null),L(e,c),S&&S.m(e,null),d=!0,h||(T=[Ee(s,"click",fs(l[18])),Ee(s,"pointerenter",l[24]),Ee(s,"pointerleave",l[25])],h=!0)},p(D,F){var W,P,te,de;let K=n;n=y(D),n===K?p[n].p(D,F):(Z(),b(p[K],1,1,()=>{p[K]=null}),H(),o=p[n],o?o.p(D,F):(o=p[n]=k[n](D),o.c()),m(o,1),o.m(s,null));const X={};F[0]&2048&&(X.show=D[11]),F[0]&2212|F[1]&1048576&&(X.$$scope={dirty:F,ctx:D}),u.$set(X),D[9]&&!D[11]?g?(g.p(D,F),F[0]&2560&&m(g,1)):(g=Et(D),g.c(),m(g,1),g.m(t,r)):g&&(Z(),b(g,1,1,()=>{g=null}),H()),D[3]==="microsoft"&&D[2]&&D[11]?_?(_.p(D,F),F[0]&2060&&m(_,1)):(_=Gt(D),_.c(),m(_,1),_.m(t,null)):_&&(Z(),b(_,1,1,()=>{_=null}),H()),D[11]&&!(D[3]==="microsoft"&&D[2])?$?($.p(D,F),F[0]&2060&&m($,1)):($=Nt(D),$.c(),m($,1),$.m(e,c)):$&&(Z(),b($,1,1,()=>{$=null}),H()),((P=(W=D[0])==null?void 0:W.subtasks)==null?void 0:P.uncompleted.length)>0||((de=(te=D[0])==null?void 0:te.subtasks)==null?void 0:de.completed.length)>0&&D[11]?S?(S.p(D,F),F[0]&2049&&m(S,1)):(S=Bt(D),S.c(),m(S,1),S.m(e,null)):S&&(Z(),b(S,1,1,()=>{S=null}),H())},i(D){d||(m(o),m(u.$$.fragment,D),m(g),m(_),m($),m(S),d=!0)},o(D){b(o),b(u.$$.fragment,D),b(g),b(_),b($),b(S),d=!1},d(D){D&&N(e),p[n].d(),B(u),g&&g.d(),_&&_.d(),$&&$.d(),S&&S.d(),h=!1,et(T)}}}function xs(l){let e,t;return e=new Ls({props:{class:"dragHandle w-full px-2.5 py-1.5",$$slots:{default:[Ps]},$$scope:{ctx:l}}}),e.$on("click",l[33]),e.$on("clickOutside",l[34]),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},p(s,n){const o={};n[0]&16383|n[1]&1048576&&(o.$$scope={dirty:n,ctx:s}),e.$set(o)},i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}const en=l=>l.stopPropagation(),tn=l=>l.stopPropagation(),sn=l=>l.key==="Enter"&&l.preventDefault();function nn(l,e,t){let s,n;const{deleteTask:o,scheduleAddNewTask:a,updateTask:u}=le("utils"),{dashyTasks:i,forceUpdate:r,googleTasks:f,todoTasks:c}=le("stores");O(l,r,C=>t(23,s=C));let{task:d}=e,{index:h}=e,{isSubtask:T=!1}=e,{parentTaskId:k=null}=e,{parentTaskIndex:p=null}=e,{parentTaskStatus:y=null}=e,{source:g}=e,{listId:_}=e;const $=g==="google"?f:g==="microsoft"?c:i;O(l,$,C=>t(35,n=C));const S=d.status==="completed"?"completed":"uncompleted",U=y==="completed"?"completed":"uncompleted";let E="",R=d.title,v=d.notes,D=d.due,F=d.status,K=!1,X=!1,W=!1,P;const te=()=>{if(!g||!_)return;const{id:C,isTemp:ee}=a(g,{source:g,listId:_,parentTaskId:d.id,newTask:{title:E}}),se={id:C,isTempId:ee,title:E,notes:"",status:"needsAction"};T||(n[_][S][h].subtasks||V($,n[_][S][h].subtasks={completed:[],uncompleted:[]},n),V($,n[_][S][h].subtasks.uncompleted=[se,...n[_][S][h].subtasks.uncompleted],n),console.log(n)),t(8,E="")},de=()=>{!g||!_||(o(g,_,d.id,k),T?V($,n[_][U][p].subtasks[S]=n[_][U][p].subtasks[S].filter(C=>C.id!==d.id),n):V($,n[_][S]=n[_][S].filter(C=>C.id!==d.id),n))},ae=()=>{if(t(10,F=F==="completed"?"needsAction":"completed"),F==="completed"&&us(cs.PUBLIC_ASSETS_ENDPOINT+"/audio/notifications/Pristine.mp3"),t(0,d.status=F,d),!g||!_)return;g!=="dashy"&&u(g,_,d.id,{status:F,parentTaskId:k});const C=F==="completed"?"completed":"uncompleted",ee=F==="completed"?"uncompleted":"completed";T?(V($,n[_][U][p].subtasks[C]=[d,...n[_][U][p].subtasks[C]],n),V($,n[_][U][p].subtasks[ee]=n[_][U][p].subtasks[ee].filter(se=>se.id!==d.id),n)):g==="google"?(d.subtasks&&(d.subtasks.uncompleted.forEach(se=>{V($,n[_][C]=[{...se,status:"completed"},...n[_][C]],n)}),d.subtasks.completed.forEach(se=>{V($,n[_][C]=[se,...n[_][C]],n)}),t(0,d.subtasks={completed:[],uncompleted:[]},d)),V($,n[_][C]=[d,...n[_][C]],n),V($,n[_][ee]=n[_][ee].filter(se=>se.id!==d.id),n)):(V($,n[_][C]=[d,...n[_][C]],n),V($,n[_][ee]=n[_][ee].filter(se=>se.id!==d.id),n))},me=C=>{const ee=C.target.value;t(9,D=_e(ee).toISOString()),!(!g||!_)&&(g!=="dashy"&&u(g,_,d.id,{due:g==="google"?new Date(ee).toISOString():ee,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,parentTaskId:k}),T?V($,n[_][U][p].subtasks[S][h].due=D,n):V($,n[_][S][h].due=D,n))},fe=pt(()=>{R!==d.title&&(!g||!_||(g!=="dashy"&&u(g,_,d.id,{title:R,parentTaskId:k}),T?V($,n[_][U][p].subtasks[S][h].title=R,n):V($,n[_][S][h].title=R,n)))},1e3),ke=pt(()=>{v!==d.notes&&(!g||!_||(g!=="dashy"&&u(g,_,d.id,{notes:v,parentTaskId:k}),T?(console.log(n[_],p),V($,n[_][U][p].subtasks[S][h].notes=v,n)):V($,n[_][S][h].notes=v,n)))},1e3),ve=()=>{R!==d.tittle&&t(5,R=d.title),v!==d.notes&&t(6,v=d.notes),F!==d.status&&t(10,F=d.status),D!==d.due&&t(9,D=d.due)},Le=()=>t(12,X=!0),qe=()=>t(12,X=!1);function Ae(C){P=C,t(7,P)}function Ze(C){R=C,t(5,R)}const Ne=C=>{C.key==="Enter"&&(C.preventDefault(),t(11,K=!1))};function Ue(C){v=C,t(6,v)}const He=()=>t(13,W=!W);function Fe(C){E=C,t(8,E)}const Qe=C=>{C.key==="Enter"&&(C.preventDefault(),te())},Ke=C=>(C.stopPropagation(),t(11,K=!0)),ne=()=>t(11,K=!1);return l.$$set=C=>{"task"in C&&t(0,d=C.task),"index"in C&&t(1,h=C.index),"isSubtask"in C&&t(2,T=C.isSubtask),"parentTaskId"in C&&t(20,k=C.parentTaskId),"parentTaskIndex"in C&&t(21,p=C.parentTaskIndex),"parentTaskStatus"in C&&t(22,y=C.parentTaskStatus),"source"in C&&t(3,g=C.source),"listId"in C&&t(4,_=C.listId)},l.$$.update=()=>{l.$$.dirty[0]&128&&P&&P.focus(),l.$$.dirty[0]&32&&fe(R),l.$$.dirty[0]&64&&ke(v),l.$$.dirty[0]&8388608&&s&&ve()},[d,h,T,g,_,R,v,P,E,D,F,K,X,W,r,$,te,de,ae,me,k,p,y,s,Le,qe,Ae,Ze,Ne,Ue,He,Fe,Qe,Ke,ne]}class at extends Me{constructor(e){super(),ye(this,e,nn,xs,Te,{task:0,index:1,isSubtask:2,parentTaskId:20,parentTaskIndex:21,parentTaskStatus:22,source:3,listId:4},null,[-1,-1])}}function Ot(l,e,t){const s=l.slice();return s[17]=e[t],s[19]=t,s}function Vt(l){let e,t,s,n,o,a,u;const i=[on,ln],r=[];function f(c,d){var h,T,k,p;return((p=(k=(T=(h=c[3])==null?void 0:h[c[2].source])==null?void 0:T[c[2].id])==null?void 0:k[c[4]?"completed":"uncompleted"])==null?void 0:p.length)>0?0:1}return s=f(l),n=r[s]=i[s](l),{c(){e=A("div"),t=A("div"),n.c(),I(t,"class","relative h-full w-full"),ps(e,"width","100%")},m(c,d){G(c,e,d),L(e,t),r[s].m(t,null),o=!0,a||(u=xe(gs.call(null,e)),a=!0)},p(c,d){let h=s;s=f(c),s===h?r[s].p(c,d):(Z(),b(r[h],1,1,()=>{r[h]=null}),H(),n=r[s],n?n.p(c,d):(n=r[s]=i[s](c),n.c()),m(n,1),n.m(t,null))},i(c){o||(m(n),o=!0)},o(c){b(n),o=!1},d(c){c&&N(e),r[s].d(),a=!1,u()}}}function ln(l){let e,t,s,n,o;const a=[an,rn],u=[];function i(r,f){return r[5]||r[6]?0:1}return t=i(l),s=u[t]=a[t](l),{c(){e=A("div"),s.c(),I(e,"class","mb-2 flex h-28 flex-col items-center justify-center gap-2")},m(r,f){G(r,e,f),u[t].m(e,null),o=!0},p(r,f){let c=t;t=i(r),t===c?u[t].p(r,f):(Z(),b(u[c],1,1,()=>{u[c]=null}),H(),s=u[t],s?s.p(r,f):(s=u[t]=a[t](r),s.c()),m(s,1),s.m(e,null))},i(r){o||(m(s),r&&ce(()=>{o&&(n||(n=x(e,ie,{},!0)),n.run(1))}),o=!0)},o(r){b(s),r&&(n||(n=x(e,ie,{},!1)),n.run(0)),o=!1},d(r){r&&N(e),u[t].d(),r&&n&&n.end()}}}function on(l){let e,t=l[4],s,n,o=qt(l);return{c(){e=A("div"),o.c()},m(a,u){G(a,e,u),o.m(e,null),n=!0},p(a,u){u&16&&Te(t,t=a[4])?(Z(),b(o,1,1,Q),H(),o=qt(a),o.c(),m(o,1),o.m(e,null)):o.p(a,u)},i(a){n||(m(o),a&&ce(()=>{n&&(s||(s=x(e,ie,{},!0)),s.run(1))}),n=!0)},o(a){b(o),a&&(s||(s=x(e,ie,{},!1)),s.run(0)),n=!1},d(a){a&&N(e),o.d(a),a&&s&&s.end()}}}function rn(l){let e,t,s,n,o,a,u;return n=new je({props:{class:"flex-center gap-2.5",$$slots:{default:[fn]},$$scope:{ctx:l}}}),n.$on("pointerdown",dn),n.$on("click",l[15]),a=new je({props:{class:"flex-center gap-2.5",$$slots:{default:[un]},$$scope:{ctx:l}}}),a.$on("pointerdown",pn),a.$on("click",l[16]),{c(){e=A("span"),e.textContent="Create a new task or connect to a service listed below to sync your tasks.",t=Y(),s=A("div"),z(n.$$.fragment),o=Y(),z(a.$$.fragment),I(e,"class","mx-8 mb-2 text-center text-sm"),I(s,"class","flex gap-4")},m(i,r){G(i,e,r),G(i,t,r),G(i,s,r),j(n,s,null),L(s,o),j(a,s,null),u=!0},p(i,r){const f={};r&1048576&&(f.$$scope={dirty:r,ctx:i}),n.$set(f);const c={};r&1048576&&(c.$$scope={dirty:r,ctx:i}),a.$set(c)},i(i){u||(m(n.$$.fragment,i),m(a.$$.fragment,i),u=!0)},o(i){b(n.$$.fragment,i),b(a.$$.fragment,i),u=!1},d(i){i&&N(e),i&&N(t),i&&N(s),B(n),B(a)}}}function an(l){let e,t,s,n;return e=new Ge({props:{icon:_s,class:"text-2x opacity-70"}}),{c(){z(e.$$.fragment),t=Y(),s=A("span"),s.textContent="No tasks yet!",I(s,"class","text-sm opacity-70")},m(o,a){j(e,o,a),G(o,t,a),G(o,s,a),n=!0},p:Q,i(o){n||(m(e.$$.fragment,o),n=!0)},o(o){b(e.$$.fragment,o),n=!1},d(o){B(e,o),o&&N(t),o&&N(s)}}}function fn(l){let e,t,s;return{c(){e=A("img"),s=oe(`
                Google Tasks`),we(e.src,t="/apps/google_tasks.png")||I(e,"src",t),I(e,"class","h-4"),I(e,"alt","Google Tasks")},m(n,o){G(n,e,o),G(n,s,o)},p:Q,d(n){n&&N(e),n&&N(s)}}}function un(l){let e,t,s;return{c(){e=A("img"),s=oe(`

                Microsoft To Do`),we(e.src,t="/apps/microsoft_todo.png")||I(e,"src",t),I(e,"class","h-4"),I(e,"alt","Google Tasks")},m(n,o){G(n,e,o),G(n,s,o)},p:Q,d(n){n&&N(e),n&&N(s)}}}function Wt(l,e){let t,s,n,o,a=Q,u;return s=new at({props:{task:e[17],index:e[19],source:e[0],listId:e[1]}}),{key:l,first:null,c(){t=A("div"),z(s.$$.fragment),n=Y(),I(t,"class","w-full"),this.first=t},m(i,r){G(i,t,r),j(s,t,null),L(t,n),u=!0},p(i,r){e=i;const f={};r&28&&(f.task=e[17]),r&28&&(f.index=e[19]),r&1&&(f.source=e[0]),r&2&&(f.listId=e[1]),s.$set(f)},r(){o=t.getBoundingClientRect()},f(){ot(t),a()},a(){a(),a=rt(t,o,it,{duration:300})},i(i){u||(m(s.$$.fragment,i),u=!0)},o(i){b(s.$$.fragment,i),u=!1},d(i){i&&N(t),B(s)}}}function qt(l){let e,t=[],s=new Map,n,o,a,u=l[3][l[2].source][l[2].id][l[4]?"completed":"uncompleted"];const i=r=>r[17].id;for(let r=0;r<u.length;r+=1){let f=Ot(l,u,r),c=i(f);s.set(c,t[r]=Wt(c,f))}return{c(){e=A("div");for(let r=0;r<t.length;r+=1)t[r].c();I(e,"class","tasks flex flex-col gap-2")},m(r,f){G(r,e,f);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);a=!0},p(r,f){if(f&31){u=r[3][r[2].source][r[2].id][r[4]?"completed":"uncompleted"],Z();for(let c=0;c<t.length;c+=1)t[c].r();t=We(t,f,i,1,r,u,s,e,lt,Wt,null,Ot);for(let c=0;c<t.length;c+=1)t[c].a();H()}},i(r){if(!a){for(let f=0;f<u.length;f+=1)m(t[f]);r&&ce(()=>{a&&(o&&o.end(1),n=tt(e,ie,{}),n.start())}),a=!0}},o(r){for(let f=0;f<t.length;f+=1)b(t[f]);n&&n.invalidate(),r&&(o=st(e,ie,{})),a=!1},d(r){r&&N(e);for(let f=0;f<t.length;f+=1)t[f].d();r&&o&&o.end()}}}function cn(l){let e,t,s=l[2]&&Vt(l);return{c(){s&&s.c(),e=Ce()},m(n,o){s&&s.m(n,o),G(n,e,o),t=!0},p(n,[o]){n[2]?s?(s.p(n,o),o&4&&m(s,1)):(s=Vt(n),s.c(),m(s,1),s.m(e.parentNode,e)):s&&(Z(),b(s,1,1,()=>{s=null}),H())},i(n){t||(m(s),t=!0)},o(n){b(s),t=!1},d(n){s&&s.d(n),n&&N(e)}}}const dn=l=>l.stopPropagation(),pn=l=>l.stopPropagation();function gn(l,e,t){let s,n,o,a,u,i;O(l,Pe,$=>t(7,i=$));const{allTasks:r,isGoogleTasksIntegrated:f,isMicrosoftTodoIntegrated:c,selectedTaskList:d,showCompletedTasks:h,googleIntegrationId:T,microsoftIntegrationId:k}=le("stores");O(l,r,$=>t(3,n=$)),O(l,f,$=>t(5,a=$)),O(l,c,$=>t(6,u=$)),O(l,d,$=>t(2,s=$)),O(l,h,$=>t(4,o=$));let{source:p}=e,{listId:y}=e;const g=()=>es({user:Oe.currentUser,currentProfile:i,integration:"google_tasks",integration_id:T}),_=()=>ts({user:Oe.currentUser,currentProfile:i,integration:"microsoft_todo",integration_id:k});return l.$$set=$=>{"source"in $&&t(0,p=$.source),"listId"in $&&t(1,y=$.listId)},[p,y,s,n,o,a,u,i,r,f,c,d,h,T,k,g,_]}class _n extends Me{constructor(e){super(),ye(this,e,gn,cn,Te,{source:0,listId:1})}}function mn(l){let e,t,s,n,o,a;const u=[hn,bn],i=[];function r(f,c){return f[1]?0:1}return t=r(l),s=i[t]=u[t](l),{c(){e=A("div"),s.c(),I(e,"class","tasks-container flex max-h-[22rem] w-full flex-col items-start svelte-146ao2a"),gt(e,"max-h-[31rem]",l[7])},m(f,c){G(f,e,c),i[t].m(e,null),a=!0},p(f,c){let d=t;t=r(f),t===d?i[t].p(f,c):(Z(),b(i[d],1,1,()=>{i[d]=null}),H(),s=i[t],s?s.p(f,c):(s=i[t]=u[t](f),s.c()),m(s,1),s.m(e,null)),(!a||c&128)&&gt(e,"max-h-[31rem]",f[7])},i(f){a||(m(s),f&&ce(()=>{a&&(o&&o.end(1),n=tt(e,pe,{duration:200,delay:200}),n.start())}),a=!0)},o(f){b(s),n&&n.invalidate(),f&&(o=st(e,pe,{duration:200})),a=!1},d(f){f&&N(e),i[t].d(),f&&o&&o.end()}}}function kn(l){let e,t;return e=new qs({props:{toggleSettings:l[14]}}),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},p:Q,i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function bn(l){let e,t,s,n,o;return n=new je({props:{$$slots:{default:[$n]},$$scope:{ctx:l}}}),n.$on("click",l[18]),{c(){e=A("div"),t=A("span"),t.textContent="Welcome to the To Do app ðŸ‘‹",s=Y(),z(n.$$.fragment),I(t,"class","text-xl"),I(e,"class","flex h-full w-full flex-col items-center justify-center gap-6")},m(a,u){G(a,e,u),L(e,t),L(e,s),j(n,e,null),o=!0},p(a,u){const i={};u&33554432&&(i.$$scope={dirty:u,ctx:a}),n.$set(i)},i(a){o||(m(n.$$.fragment,a),o=!0)},o(a){b(n.$$.fragment,a),o=!1},d(a){a&&N(e),B(n)}}}function hn(l){let e,t,s,n,o,a,u,i;function r(c){l[16](c)}let f={type:"text",placeholder:"What's next?",class:"w-full",size:"md"};return l[3]!==void 0&&(f.value=l[3]),t=new Qt({props:f}),be.push(()=>he(t,"value",r)),t.$on("keyup",l[17]),o=new Ie({props:{icon:Ve,class:"text-[1.5rem]"}}),o.$on("click",l[15]),u=new _n({props:{source:l[0],listId:l[4]}}),{c(){e=A("div"),z(t.$$.fragment),n=Y(),z(o.$$.fragment),a=Y(),z(u.$$.fragment),I(e,"class","mb-2.5 flex w-full gap-4 px-0.5")},m(c,d){G(c,e,d),j(t,e,null),L(e,n),j(o,e,null),G(c,a,d),j(u,c,d),i=!0},p(c,d){const h={};!s&&d&8&&(s=!0,h.value=c[3],$e(()=>s=!1)),t.$set(h);const T={};d&1&&(T.source=c[0]),d&16&&(T.listId=c[4]),u.$set(T)},i(c){i||(m(t.$$.fragment,c),m(o.$$.fragment,c),m(u.$$.fragment,c),i=!0)},o(c){b(t.$$.fragment,c),b(o.$$.fragment,c),b(u.$$.fragment,c),i=!1},d(c){c&&N(e),B(t),B(o),c&&N(a),B(u,c)}}}function $n(l){let e;return{c(){e=oe("Get Started")},m(t,s){G(t,e,s)},d(t){t&&N(e)}}}function Zt(l){let e,t,s,n;return t=new Ys({props:{toggleSettings:l[14]}}),{c(){e=A("div"),z(t.$$.fragment)},m(o,a){G(o,e,a),j(t,e,null),n=!0},p:Q,i(o){n||(m(t.$$.fragment,o),ce(()=>{n&&(s||(s=x(e,ie,{duration:300},!0)),s.run(1))}),n=!0)},o(o){b(t.$$.fragment,o),s||(s=x(e,ie,{duration:300},!1)),s.run(0),n=!1},d(o){o&&N(e),B(t),o&&s&&s.end()}}}function wn(l){let e,t,s,n,o,a;const u=[kn,mn],i=[];function r(c,d){return c[6]?0:1}s=r(l),n=i[s]=u[s](l);let f=(l[7]||l[8]&&!l[6])&&Zt(l);return{c(){e=A("div"),t=A("div"),n.c(),o=Y(),f&&f.c(),I(t,"class","transition-container h-max w-[24rem] px-2"),I(e,"class","py-2.5")},m(c,d){G(c,e,d),L(e,t),i[s].m(t,null),L(e,o),f&&f.m(e,null),a=!0},p(c,[d]){let h=s;s=r(c),s===h?i[s].p(c,d):(Z(),b(i[h],1,1,()=>{i[h]=null}),H(),n=i[s],n?n.p(c,d):(n=i[s]=u[s](c),n.c()),m(n,1),n.m(t,null)),c[7]||c[8]&&!c[6]?f?(f.p(c,d),d&448&&m(f,1)):(f=Zt(c),f.c(),m(f,1),f.m(e,null)):f&&(Z(),b(f,1,1,()=>{f=null}),H())},i(c){a||(m(n),m(f),a=!0)},o(c){b(n),b(f),a=!1},d(c){c&&N(e),i[s].d(),f&&f.d()}}}function Tn(l,e,t){let s,n,o,a,u=Q,i=()=>(u(),u=ks(o,W=>t(19,a=W)),o),r,f,c,d,h;l.$$.on_destroy.push(()=>u());const{scheduleAddNewTask:T,updateTasks:k}=le("utils"),{allTasksList:p,dashyTasks:y,googleTasks:g,selectedTaskList:_,todoTasks:$}=le("stores");O(l,p,W=>t(2,f=W)),O(l,_,W=>t(1,r=W));const S=le("appView");O(l,S,W=>t(7,d=W));const U=le("appActive");O(l,U,W=>t(8,h=W)),ms(()=>{k()});let E="";const[R,v]=bs();O(l,R,W=>t(6,c=W));const D=()=>{var de;if(!n||!s)return;const{id:W,isTemp:P}=T(s,{listId:n,source:s,newTask:{title:E}}),te={id:W,isTempId:P,title:E,status:"needsAction",subtasks:{completed:[],uncompleted:[]}};t(3,E=""),(de=a[n])!=null&&de.uncompleted||V(o,a[n]={uncompleted:[],completed:[]},a),V(o,a[n].uncompleted=[te,...a[n].uncompleted],a)};function F(W){E=W,t(3,E)}const K=W=>{W.key==="Enter"&&D()},X=()=>V(_,r=f[0],r);return l.$$.update=()=>{l.$$.dirty&6&&(f.find(W=>(r==null?void 0:r.id)===W.id)||V(_,r={id:"default",title:"Tasks",source:"dashy"},r)),l.$$.dirty&2&&t(0,s=r==null?void 0:r.source),l.$$.dirty&2&&t(4,n=r==null?void 0:r.id),l.$$.dirty&1&&i(t(5,o=s==="google"?g:s==="microsoft"?$:y))},[s,r,f,E,n,o,c,d,h,p,_,S,U,R,v,D,F,K,X]}class In extends Me{constructor(e){super(),ye(this,e,Tn,wn,Te,{})}}function vn(l){let e,t;return e=new Ts({props:{embeddedInsideApp:!0,customText:"Integrations are only available for Dashy Pro users. Upgrade now to use this widget.",name:"Google Tasks",iconImg:"/apps/google_tasks.png",iconImg2:"/apps/microsoft_todo.png",name2:"Microsoft To Do"}}),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},p:Q,i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Ln(l){let e,t,s,n;const o=[Dn,Sn],a=[];function u(i,r){return i[1]&&i[0]&&i[2]?0:1}return e=u(l),t=a[e]=o[e](l),{c(){t.c(),s=Ce()},m(i,r){a[e].m(i,r),G(i,s,r),n=!0},p(i,r){let f=e;e=u(i),e!==f&&(Z(),b(a[f],1,1,()=>{a[f]=null}),H(),t=a[e],t||(t=a[e]=o[e](i),t.c()),m(t,1),t.m(s.parentNode,s))},i(i){n||(m(t),n=!0)},o(i){b(t),n=!1},d(i){a[e].d(i),i&&N(s)}}}function Sn(l){let e,t;return e=new vs({}),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Dn(l){let e,t;return e=new In({}),{c(){z(e.$$.fragment)},m(s,n){j(e,s,n),t=!0},i(s){t||(m(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Mn(l){let e,t,s,n;const o=[Ln,vn],a=[];function u(i,r){return 0}return e=u(),t=a[e]=o[e](l),{c(){t.c(),s=Ce()},m(i,r){a[e].m(i,r),G(i,s,r),n=!0},p(i,r){t.p(i,r)},i(i){n||(m(t),n=!0)},o(i){b(t),n=!1},d(i){a[e].d(i),i&&N(s)}}}function yn(l,e,t){let s,n,o,a,u,i,r,f,c,d,h,T;O(l,hs,w=>t(2,c=w));let{config:k}=e;const p=k.id,y=k.id==="todo"?"google_tasks":`google_tasks_${p}`,g=k.id==="todo"?"microsoft_todo":`microsoft_todo_${p}`,_=Ye(1),$=Ye(!1),S=Ye(!1),U=Ye([]),E={path:`user_data/{uid}/profiles/{currentProfile}/apps/${p}`,currentProfile:Pe,uid:Is},{create:R,start:v,stop:D,isFetched:F,createPersist:K}=$s(E);O(l,F,w=>t(1,a=w));const X=K("tasksListsFetched",!1);O(l,X,w=>t(0,o=w));const W=R("selectedTaskList",{id:"default",title:"Dashy List",source:"dashy"}),P=R("list",[{id:"default",title:"Dashy List",source:"dashy"}]);O(l,P,w=>t(23,s=w));const te=R("excludedTaskLists",[]);O(l,te,w=>t(19,r=w));const de=R("tasks",{default:{completed:[],uncompleted:[]}}),ae=K("googleTasksList",[]);O(l,ae,w=>t(21,h=w));const me=K("googleTasks",{});O(l,me,w=>t(25,d=w));const fe=K("todoTasksList",[]);O(l,fe,w=>t(18,i=w));const ke=K("todoTasks",{});O(l,ke,w=>t(24,u=w));const ve=ze([_t],([w])=>{var M;return((M=w==null?void 0:w[y])==null?void 0:M.id)??!1});O(l,ve,w=>t(22,T=w));const Le=ze([_t],([w])=>{var M;return((M=w==null?void 0:w[g])==null?void 0:M.id)??!1});O(l,Le,w=>t(20,f=w));const qe=ze([de,me,ke,ve,Le],([w,M,q,J,ue])=>({dashy:w,...J&&{google:M},...ue&&{microsoft:q}})),Ae=ze([P,ae,fe],([w,M,q])=>[...w.map(J=>({...J,source:"dashy"})),...M.map(J=>({...J,source:"google"})),...q.map(J=>({...J,source:"microsoft"}))]);O(l,Ae,w=>t(17,n=w));const Ze=ze([Ae,te],([w,M])=>w.filter(q=>!M.includes(q.id)));let Ne=T,Ue=f;v(),mt("stores",{allTasks:qe,allTasksList:Ae,availableTasksList:Ze,dashyTasks:de,dashyTasksList:P,excludedTaskLists:te,googleTasks:me,googleTasksList:ae,isGoogleTasksIntegrated:ve,isMicrosoftTodoIntegrated:Le,selectedTaskList:W,showCompletedTasks:$,todoTasks:ke,todoTasksList:fe,updatingTasks:S,tempIds:U,forceUpdate:_,googleIntegrationId:y,microsoftIntegrationId:g});const He=(w,M)=>{const q="TEMP_"+Xe();return w==="google"||w==="microsoft"?(U.update(J=>[...J,{tempId:q,source:w,actualId:null}]),Fe(M,q),{id:q,isTemp:!0}):w==="dashy"?{id:Xe(),isTemp:!1}:{id:q,isTemp:!0}},Fe=async(w,M)=>{const{source:q,parentTaskId:J,previousTaskId:ue,listId:ct,newTask:dt}=w;if(q==="google"){const Se=await re.post("/integration/google_tasks/create",{listId:ct,parentTaskId:J&&ne(J),previousTaskId:ue&&ne(ue),...dt},{params:{widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error adding new task to Google Tasks"));if(!Se)return{success:!1};Se.data.success&&U.update(Je=>Je.map(De=>De.tempId===M?{...De,actualId:Se.data.task.id}:De))}if(q==="microsoft"){const Se=await re.post("/integration/microsoft_todo/create",{listId:ct,parentTaskId:J,previousTaskId:ue,...dt},{params:{widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error adding new task to Microsoft To Do"));if(!Se)return{success:!1};Se.data.success&&U.update(Je=>Je.map(De=>De.tempId===M?{...De,actualId:Se.data.task.id}:De))}},Qe=async(w,M,q,J)=>{w==="google"&&await re.delete("/integration/google_tasks/delete",{params:{listId:M,taskId:ne(q),widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error deleting task from Google Tasks")),w==="microsoft"&&await re.delete("/integration/microsoft_todo/delete",{params:{listId:M,taskId:ne(q),...J&&{parentTaskId:ne(J)},widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error deleting task from Microsoft To Do"))},Ke=(w,M)=>{if(w==="google"){if(M!=null&&M.taskId&&(M.taskId=ne(M.taskId)),M!=null&&M.parentTaskId&&(M.parentTaskId=ne(M.parentTaskId)),M!=null&&M.previousTaskId&&(M.previousTaskId=ne(M.previousTaskId)),[M==null?void 0:M.taskId,M==null?void 0:M.parentTaskId,M==null?void 0:M.previousTaskId].includes(null))return;re.post("/integration/google_tasks/move",M,{params:{widgetId:p==="todo"?"":p}}).catch(q=>{console.log(q)})}},ne=w=>{if(w.startsWith("TEMP_")){const M=ge(U).find(q=>q.tempId===w);return(M==null?void 0:M.actualId)||null}else return w},C=async(w,M,q,J)=>{if(w==="google"){const ue=ne(q);if(!ue)return;re.patch("/integration/google_tasks/update",{listId:M,taskId:ue,...J},{params:{widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error updating task in Google Tasks"))}if(w==="microsoft"){const ue=ne(q);if(!ue)return;re.patch("/integration/microsoft_todo/update",{listId:M,taskId:ue,...J},{params:{widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error updating task in Microsoft To Do"))}},ee=async()=>{const w=await re.get("/integration/google_tasks/get_lists",{params:{widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error fetching Google Task Lists"));if(!w)return{success:!1};if(w.data.success)return ae.set(w.data.lists),{success:!0}},se=async()=>{const w=await re.get("/integration/microsoft_todo/get_lists",{params:{widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error fetching Microsoft To Do Lists"));if(!w)return{success:!1};if(w.data.success)return fe.set(w.data.lists),{success:!0}},ft=async()=>{if(!ge(ve))return;let w=ge(ae);(!w||w.length===0)&&(await ee(),w=ge(ae));const M=await re.get("/integration/google_tasks/get",{params:{listIds:ge(ae).map(q=>q.id).join(","),widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error fetching Google Tasks"));if(!M)return{success:!1};if(M.data.success)return me.set(M.data.tasks),{success:!0}},ut=async()=>{if(!ge(Le))return;let w=ge(fe);if(!w||w.length===0){await se(),w=ge(fe);return}const M=await re.get("/integration/microsoft_todo/get",{params:{listIds:ge(fe).map(q=>q.id).join(","),widgetId:p==="todo"?"":p}}).catch(()=>console.log("Error fetching Microsoft To Do Tasks"));if(!M)return{success:!1};if(M.data.success)return ke.set(M.data.tasks),{success:!0}},Re=async()=>{S.set(!0);const w=await Promise.all([ft(),ut()]).catch(()=>{console.log("Error updating tasks"),S.set(!1)});return S.set(!1),_.set(ws(0,1e6)),w};return mt("utils",{scheduleAddNewTask:He,addNewTask:Fe,deleteTask:Qe,moveTask:Ke,updateTask:C,fetchGoogleLists:ee,fetchTodoLists:se,fetchGoogleTasks:ft,fetchTodoTasks:ut,updateTasks:Re,getIconForProvider:w=>{switch(w){case"google":return"/apps/google_tasks.png";case"microsoft":return"/apps/microsoft_todo.png";default:return"/icon.png"}},resolveTaskId:ne}),l.$$set=w=>{"config"in w&&t(14,k=w.config)},l.$$.update=()=>{l.$$.dirty[0]&6848516&&T!==Ne&&c&&(t(15,Ne=T),V(te,r=r.filter(w=>!h.find(M=>M.id===w)),r),V(ae,h=[],h),V(me,d={},d),Re()),l.$$.dirty[0]&1900548&&f!==Ue&&c&&(t(16,Ue=f),V(te,r=r.filter(w=>!i.find(M=>M.id===w)),r),V(fe,i=[],i),V(ke,u={},u),Re()),l.$$.dirty[0]&3&&a&&(o||Re().then(()=>{V(X,o=!0,o)})),l.$$.dirty[0]&131072&&n.length===0&&V(P,s=[{id:"all",title:"All Tasks",source:"dashy"}],s)},[o,a,c,F,X,P,te,ae,me,fe,ke,ve,Le,Ae,k,Ne,Ue,n,i,r,f,h,T]}class zn extends Me{constructor(e){super(),ye(this,e,yn,Mn,Te,{config:14},null,[-1,-1])}}export{zn as default};
